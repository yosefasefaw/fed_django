{% extends "base.html" %}
{% load static %}

{% block title %}Report Box - Fed Intelligence{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/report_box.css' %}">
{% endblock %}

{% block content %}
<div class="report-box-page animate-fade-in">

    <header class="page-header">
        <h1>Report Box</h1>
        <p class="text-muted">All generated reports from the multi-agent pipelines, sorted by date. Click a row to view
            details.</p>
        {% if next_run %}
        <div class="next-update-info"
            style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280; display: flex; align-items: center; gap: 0.5rem;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-clock">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span style="font-weight: 500;">Next Scheduled Update:</span>
            <span>{{ next_run|date:"M d, Y H:i" }} UTC</span>
        </div>
        {% endif %}
    </header>

    <div class="table-wrapper card">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Focus</th>
                    <th>FOMC Date</th>
                    <th>Delta</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr class="clickable-row" {% if report.report_type == "summary" %}
                    data-href="{% url 'multi_agent_systems:summary_detail' uuid=report.uuid %}" {% else %}
                    data-href="{% url 'multi_agent_systems:topic_analysis_detail' uuid=report.uuid %}" {% endif %}>
                    <td class="date-cell">{{ report.created_at|date:"Y-m-d H:i" }}</td>
                    <td>
                        {% if report.report_type == "summary" %}
                        <span class="type-badge type-summary">Summary</span>
                        {% else %}
                        <span class="type-badge type-analysis">Analysis</span>
                        {% endif %}
                    </td>
                    <td>
                        <span
                            class="focus-badge {% if 'post' in report.get_timing_focus|lower %}focus-post{% elif 'pre' in report.get_timing_focus|lower %}focus-pre{% else %}focus-announcement{% endif %}">
                            {{ report.get_timing_focus }}
                        </span>
                    </td>
                    <td>
                        {% if report.fomc_announcement_datetime %}
                        {{ report.fomc_announcement_datetime|date:"Y-m-d" }}
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>
                        {{ report.get_timing_delta|default:"-" }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="empty-row">No reports generated yet. Run the scheduler to generate summaries
                        and analyses.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/report_box.js' %}"></script>
{% endblock %}